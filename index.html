function calc() {
  // Inputs
  const pizzas = +pizzasEl.value || 0;
  const doughW = +doughWeightEl.value || 0;

  const hydration = (+hydrationEl.value || 0) / 100;
  const saltPct   = (+saltPctEl.value || 0) / 100;

  // Observable-style: starter is % of total flour (starter weight)
  const starterPct = (+levainPctEl.value || 0) / 100;

  const type00Pct = (+type00PctEl.value || 0) / 100;
  const hgPct = 1 - type00Pct;

  // Totals
  const totalDough = pizzas * doughW;

  // Observable-style dough mass model:
  // totalDough = flour + water + salt + starter
  // water = flour * hydration
  // salt  = flour * saltPct
  // starter = flour * starterPct  (starter weight)
  // => totalDough = flour * (1 + hydration + saltPct + starterPct)
  const totalFlour = totalDough / (1 + hydration + saltPct + starterPct);

  // Starter (100% hydration)
  const levainTotal = totalFlour * starterPct; // starter weight
  const levainFlour = levainTotal / 2;
  const levainWater = levainTotal / 2;

  // Total water in dough (incl starter water)
  const totalWater = totalFlour * hydration;

  // Water to ADD (subtract the water already inside starter)
  const waterToAdd = Math.max(0, totalWater - levainWater);

  const salt = totalFlour * saltPct;

  // Flour split overall (includes levain flour in the total flour accounting)
  const type00Flour = totalFlour * type00Pct;
  const highGradeTotalRequired = totalFlour * hgPct;

  // High grade flour to add in the main mix (levain flour is already HG)
  const highGradeFlourToAdd = highGradeTotalRequired - levainFlour;
  const hgToAddSafe = Math.max(0, highGradeFlourToAdd);

  // Dough quantities output (ordered workflow)
  doughOut.innerHTML = `
    <b>ADD THE FOLLOWING (in this order)</b><br><br>
    <b>1. Water:</b> <b>${waterToAdd.toFixed(0)} g</b><br>
    <b>2. Starter (100% hydration, High Grade):</b> <b>${levainTotal.toFixed(0)} g</b><br>
    <b>3. Type 00 Pizza Flour:</b> <b>${type00Flour.toFixed(0)} g</b><br>
    <b>4. High Grade Flour:</b> <b>${hgToAddSafe.toFixed(0)} g</b><br>
    <b>5. Salt (after autolyse):</b> <b>${salt.toFixed(0)} g</b><br><br>
    <small>
      Total dough: ${totalDough.toFixed(0)} g ·
      Total flour: ${totalFlour.toFixed(0)} g ·
      Total water: ${totalWater.toFixed(0)} g ·
      Starter: ${levainTotal.toFixed(0)} g
    </small>
  `;

  // Starter planning (simple heuristic)
  const starterTemp = +starterTempEl.value;
  const starterHours = 12 - (starterTemp - 20) * 0.8;

  starterOut.innerHTML = `
    Target starter: <b>${levainTotal.toFixed(0)} g</b><br>
    Expected doubling time (rough): <b>${starterHours.toFixed(1)} h</b><br>
    Tip: build in stages so the starter peaks close to your mix time.
  `;

  // When to bake (clock time output)
  const doughTemp = +doughTempEl.value;

  const mixHour = clamp(+mixHourEl.value || 12, 1, 12);
  const mixMin  = clamp(+mixMinEl.value || 0, 0, 59);
  const mixAmPm = mixAmPmEl.value || "PM";
  const mixAtMins = toMinutes(mixHour, mixMin, mixAmPm);

  const primeStartHours = 6 - (doughTemp - 22) * 0.6;
  const primeEndHours   = primeStartHours + 2;

  const windowStart = mixAtMins + Math.round(primeStartHours * 60);
  const windowEnd   = mixAtMins + Math.round(primeEndHours * 60);

  fermentOut.innerHTML = `<b>${fmtTime(windowStart)} – ${fmtTime(windowEnd)}</b> <b>BAKE TIME</b>`;
  fermentHint.textContent = `Ready to bake window (approx): ${primeStartHours.toFixed(1)}–${primeEndHours.toFixed(1)} hours after mixing`;
}
